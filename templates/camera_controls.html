{# camera control settings #}
<h2 class="pb-2 mb-4 border-bottom">Camera Settings</h2>

<div class="container text-center mt-4">
    <div class="row justify-content-center">

        <div class="col-6">
            <a href="/camera_{{ camera.Num }}"
               class="btn btn-lg w-100 d-flex flex-column align-items-center px-4
               {% if mode == 'desktop' %} btn-primary {% else %} btn-secondary {% endif %}">
                <i class="bi bi-webcam fs-2"></i>
                <span class="fw-bold mt-1">Desktop</span>
            </a>
        </div>

        <div class="col-6">
            <a href="/camera_mobile_{{ camera.Num }}"
               class="btn btn-lg w-100 d-flex flex-column align-items-center px-4
               {% if mode == 'mobile' %} btn-primary {% else %} btn-secondary {% endif %}">
                <i class="bi bi-person-badge fs-2"></i>
                <span class="fw-bold mt-1">Mobile</span>
            </a>
        </div>

    </div>
</div>

<!-- ===================================== -->
<!-- Generic settings accordion -->
<!-- ===================================== -->

<div class="accordion pt-3" id="settingsAccordion">
    {% for section in settings.sections if section.enabled %}
    <div class="accordion-item">

        <h2 class="accordion-header">
            <button class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#section{{ loop.index }}">
                {{ section.name }}
            </button>
        </h2>

        <div id="section{{ loop.index }}"
             class="accordion-collapse collapse"
             data-bs-parent="#settingsAccordion">

            <div class="accordion-body">

                {% for setting in section.settings if setting.enabled %}

                    {% include "settings/" + setting.type + ".html" %}

                    {% if setting.childsettings %}
                    <div id="{{ setting.id }}_dependencies"
                         class="collapse"
                         data-parent="{{ setting.id }}">
                        {% for child in setting.childsettings if child.enabled %}
                            {% set setting = child %}
                            {% include "settings/" + child.type + ".html" %}
                        {% endfor %}
                    </div>
                    {% endif %}

                {% endfor %}

            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="mt-4"></div>

<!-- ===================================== -->
<!-- Profile Accordion -->
<!-- ===================================== -->

<div class="accordion" id="ProfileAccordion">
    <!-- Load / Save / Reset / Delete camera profile -->
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseProfile">
                Camera Profiles
            </button>
        </h2>

        <div id="collapseProfile"
             class="accordion-collapse collapse"
             data-bs-parent="#ProfileAccordion">

            <div class="accordion-body">

                <div class="btn-group mb-3" role="group">
                    <button type="button" class="btn btn-primary active"
                            onclick="showProfileSection('loadProfile')">Load</button>
                    <button type="button" class="btn btn-primary"
                            onclick="showProfileSection('saveProfile')">Save</button>
                    <button type="button" class="btn btn-warning"
                            onclick="showProfileSection('resetProfile')">Reset</button>
                    <button type="button" class="btn btn-danger"
                            onclick="showProfileSection('deleteProfile')">Delete</button>

                </div>

                <!-- Load Profile -->
                <div id="loadProfile" class="profile-section">
                    <div class="alert alert-danger d-none" id="configAlert"></div>

                    <table class="table" id="configTable">
                        <thead>
                            <tr>
                                <th>Select</th>
                                <th>Filename</th>
                                <th>Sensor</th>
                                <th>Active</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for profile in profiles %}
                            <tr {% if profile.active %}class="table-success"{% endif %}>
                                <td>
                                    <input type="radio"
                                        name="selectedConfig"
                                        value="{{ profile.filename }}"
                                        data-model="{{ profile.model }}"
                                        {% if profile.active %}checked{% endif %}>
                                </td>
                                <td>{{ profile.filename }}</td>
                                <td>{{ profile.model }}</td>
                                <td>
                                    {% if profile.active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="text-muted">Inactive</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4">No profiles found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <button class="btn btn-primary"
                            id="loadProfileBtn"
                            onclick="loadConfigFile()">
                        Load Selected Profile
                    </button>

                </div>

                <!-- Save Profile -->
                <div id="saveProfile" class="profile-section d-none">
                    <input type="text"
                           class="form-control mb-2"
                           id="saveConfigFile"
                           placeholder="Enter profile name">
                    <button class="btn btn-primary"
                            onclick="saveProfile({{ camera.Num }})">Save</button>
                </div>

                <!-- Reset Profile -->
                <div id="resetProfile" class="profile-section d-none">
                    <button class="btn btn-warning"
                            onclick="resetProfile({{ camera.Num }})">Reset to Default</button>
                </div>

                <div class="alert alert-danger d-none mt-2" id="profileAlert"></div>

                <!-- Delete Profile -->
                <div id="deleteProfile" class="profile-section d-none">
                    <div class="alert alert-danger d-none" id="deleteAlert"></div>

                    <table class="table" id="deleteConfigTable">
                        <thead>
                            <tr>
                                <th>Select</th>
                                <th>Filename</th>
                                <th>Sensor</th>
                                <th>Active</th> <!-- Neue Spalte -->
                            </tr>
                        </thead>

                        <tbody>
                            {% for profile in profiles %}
                            <tr {% if profile.active %}class="table-success"{% endif %}>
                                <td>
                                    <input type="radio"
                                        name="selectedDeleteConfig"
                                        value="{{ profile.filename }}"
                                        data-model="{{ profile.model }}"
                                        {% if profile.active %}disabled{% endif %}>
                                </td>
                                <td>{{ profile.filename }}</td>
                                <td>{{ profile.model }}</td>
                                <td>
                                    {% if profile.active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="text-muted">Inactive</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4">No profiles available to delete</td>
                            </tr>
                            {% endfor %}
                        </tbody>

                    </table>

                    <button class="btn btn-danger"
                            onclick="requestDeleteProfile({{ camera.Num }})">
                        Delete Selected Profile
                    </button>

                </div>
            </div>

        </div>
    </div>
</div>

<!-- ===================================== -->
<!-- Delete profile confirmation modal -->
<!-- ===================================== -->
<div class="modal fade" id="deleteProfileModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-danger">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirm Profile Deletion</h5>
                <button type="button" class="btn-close"
                        data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <p>
                    You are about to permanently delete the profile
                    <strong id="deleteProfileName"></strong>.
                </p>
                <p class="text-danger mb-0">
                    This action cannot be undone.
                </p>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary"
                        data-bs-dismiss="modal">
                    Cancel
                </button>
                <button class="btn btn-danger"
                        onclick="confirmDeleteProfile()">
                    Delete Profile
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ===================================== -->
<!-- Model mismatch modal -->
<!-- ===================================== -->

<div class="modal fade" id="modelMismatchModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Profile Sensor Mismatch</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Profile "<span id="mismatchProfileName"></span>" was saved/configured for a different
                camera sensor/model. Continue?
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-danger" id="confirmLoadProfile">Load Anyway</button>
            </div>
        </div>
    </div>
</div>
    
<script>

let camera_num = {{ camera.Num }};
let pendingDeleteCameraNum = null;
let pendingDeleteFilename = null;

function showProfileSection(sectionId) {
    // Hide all profile sections
    document.querySelectorAll('.profile-section').forEach(section => {
        section.classList.add('d-none');
    });

    // Show the selected section
    document.getElementById(sectionId).classList.remove('d-none');

    // Remove 'active' class from all buttons
    document.querySelectorAll('.btn-group .btn').forEach(button => {
        button.classList.remove('active');
    });

    // Add 'active' class to the clicked button
    event.target.classList.add('active');
}


// Function to load the selected profile
function loadConfigFile() {
    const selectedProfile = document.querySelector('input[name="selectedConfig"]:checked');
    if (!selectedProfile) {
        alert("Please select a profile to load.");
        return;
    }

    const profileName = selectedProfile.value;
    const profileModel = selectedProfile.getAttribute("data-model");
    const currentModel = "{{ camera.Model }}";

    if (profileModel !== currentModel) {
        // Show Bootstrap modal if model mismatch
        const modalElement = new bootstrap.Modal(document.getElementById("modelMismatchModal"));
        document.getElementById("mismatchProfileName").textContent = profileName;
        modalElement.show();
    } else {
        applyProfile(profileName);
    }
}

function applyProfile(profileName) {
    const alertBox = document.getElementById("profileAlert");

    fetch(`/load_profile`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            profile_name: profileName,
            camera_num: camera_num
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            console.log("Profile loaded successfully.");
            showAlert(alertBox, "success", data.message);
            updateProfileList(); // Refresh profile list after loading
            // fetchCameraProfile(); 
        } else {
            console.log("Failed to load profile: " + data.error);
        }
    })
    .catch(error => console.error("Error loading profile:", error));
}

function saveProfile(cameraNum) {
    const filename = document.getElementById("saveConfigFile").value;
    const alertBox = document.getElementById("profileAlert");

    if (!filename) {
        showAlert(alertBox, "danger", "Please enter a filename.");
        return;
    }

    fetch(`/save_profile_${cameraNum}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ filename: filename })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            showAlert(alertBox, "success", data.message);
            updateProfileList(); // Refresh profile list after loading
        } else {
            showAlert(alertBox, "danger", data.error || "Failed to save profile.");
        }
    })
    .catch(error => {
        console.error("Error:", error);
        showAlert(alertBox, "danger", "An unexpected error occurred.");
    });
}

function resetProfile(cameraNum) {
    fetch(`/reset_profile_${cameraNum}`, { 
        method: "POST"
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert(document.getElementById("profileAlert"), "success", "Profile reset to default!");
            updateProfileList(); // Refresh profile list after loading
            // fetchCameraProfile(); // Fetch updated settings
        } else {
            showAlert(document.getElementById("profileAlert"), "danger", "Error: " + data.message);
        }
    })
    .catch(error => {
        showAlert(document.getElementById("profileAlert"), "danger", "Request failed: " + error);
    });
}

function requestDeleteProfile(cameraNum) {
    const selected =
        document.querySelector('input[name="selectedDeleteConfig"]:checked');

    if (!selected) {
        showAlert(
            document.getElementById("deleteAlert"),
            "danger",
            "Please select a profile to delete."
        );
        return;
    }

    if (selected.disabled) {
        showAlert(
            document.getElementById("deleteAlert"),
            "danger",
            "The active profile cannot be deleted."
        );
        return;
    }

    pendingDeleteCameraNum = cameraNum;
    pendingDeleteFilename = selected.value;

    document.getElementById("deleteProfileName").textContent =
        pendingDeleteFilename;

    new bootstrap.Modal(
        document.getElementById("deleteProfileModal")
    ).show();
}

function deleteProfile(cameraNum, filename) {
    fetch(`/delete_profile_${cameraNum}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ filename })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert(
                document.getElementById("deleteAlert"),
                "success",
                "Profile deleted successfully."
            );
            updateProfileList();
            // fetchCameraProfile();
        } else {
            showAlert(
                document.getElementById("deleteAlert"),
                "danger",
                data.message || "Delete failed."
            );
        }
    })
    .catch(error => {
        showAlert(
            document.getElementById("deleteAlert"),
            "danger",
            "Request failed: " + error
        );
    });
}

function confirmDeleteProfile() {
    if (pendingDeleteCameraNum === null || pendingDeleteFilename === null) {
        console.error("Delete confirmation without pending data");
        return;
    }

    deleteProfile(
        pendingDeleteCameraNum,
        pendingDeleteFilename
    );

    pendingDeleteCameraNum = null;
    pendingDeleteFilename = null;

    bootstrap.Modal
        .getInstance(
            document.getElementById("deleteProfileModal")
        )
        .hide();
}

// Fetch updated settings after reset
// function fetchCameraProfile() {
//     fetch(`/get_camera_profile?camera_num=${camera_num}`)
//     .then(response => response.json())
//     .then(data => {
//         if (data.success) {
//             updateUIFromCameraProfile(data.camera_profile);
//         } else {
//             console.error("Failed to fetch live controls:", data.error);
//         }
//     })
//     .catch(error => console.error("Error fetching live controls:", error));
// }

// function updateUIFromCameraProfile(cameraProfile) {
//     console.log("Updating UI from camera profile:", cameraProfile);

//     // Manually update hflip, vflip
//     const manualKeys = ["hflip", "vflip", "saveRAW"];
//     manualKeys.forEach(key => {
//         let element = document.getElementById(key);
//         if (element) {
//             if (element.type === "checkbox") {
//                 element.checked = cameraProfile[key];
//                 console.log(`Set ${key} (checkbox) to:`, element.checked);
//             } else {
//                 element.value = cameraProfile[key];
//                 console.log(`Set ${key} (input) to:`, element.value);
//             }
//         } else {
//             console.warn(`Element with ID '${key}' not found.`);
//         }
//     });

//     // Iterate through controls and update UI
//     if (cameraProfile.controls) {
//         for (const [key, value] of Object.entries(cameraProfile.controls)) {
//             let element = document.getElementById(key);

//             // If the element isn't found, check for radio buttons and checkboxes
//             if (!element) {
//                 let radioElement = document.querySelector(`input[name="${key}"][value="${value}"]`);
//                 if (radioElement) {
//                     radioElement.checked = true;
//                     console.log(`Set ${key} (radio) to: ${value}`);
//                     continue;
//                 }

//                 let checkboxElement = document.querySelector(`input[name="${key}"]`);
//                 if (checkboxElement && checkboxElement.type === "checkbox") {
//                     checkboxElement.checked = Boolean(value);
//                     console.log(`Set ${key} (checkbox) to:`, checkboxElement.checked);
//                     continue;
//                 }

//                 console.warn(`Element with ID '${key}' not found.`);
//                 continue;
//             }

//             // Handle different input types
//             if (element.type === "checkbox") {
//                 element.checked = Boolean(value);
//                 console.log(`Set ${key} (checkbox) to:`, element.checked);
//             } else if (element.type === "radio") {
//                 let radioElement = document.getElementById(`${key}_${value}`);
//                 if (radioElement) {
//                     radioElement.checked = true;
//                     console.log(`Set ${key} (radio) to: ${value}`);
//                 } else {
//                     console.warn(`Radio button for ${key} with ID '${key}_${value}' not found.`);
//                 }
//             } else {
//                 element.value = value;
//                 console.log(`Set ${key} (input) to:`, element.value);
//             }

//             // Update UI labels for range inputs
//             if (element.type === "range") {
//                 let valueLabel = document.getElementById("current" + key);
//                 if (valueLabel) {
//                     valueLabel.textContent = `Value: ${value}`;
//                     console.log(`Updated label for ${key} to:`, valueLabel.textContent);
//                 }
//             }
//         }
//     } 
//     // Iterate through resolutions and update UI
//     if (cameraProfile.resolutions) {
//         for (const [key, value] of Object.entries(cameraProfile.resolutions)) {
//             let element = document.getElementById(key);

//             // If the element isn't found, check for radio buttons and checkboxes
//             if (!element) {
//                 let radioElement = document.querySelector(`input[name="${key}"][value="${value}"]`);
//                 if (radioElement) {
//                     radioElement.checked = true;
//                     console.log(`Set ${key} (radio) to: ${value}`);
//                     continue;
//                 }

//                 let checkboxElement = document.querySelector(`input[name="${key}"]`);
//                 if (checkboxElement && checkboxElement.type === "checkbox") {
//                     checkboxElement.checked = Boolean(value);
//                     console.log(`Set ${key} (checkbox) to:`, checkboxElement.checked);
//                     continue;
//                 }

//                 console.warn(`Element with ID '${key}' not found.`);
//                 continue;
//             }

//             // Handle different input types
//             if (element.type === "checkbox") {
//                 element.checked = Boolean(value);
//                 console.log(`Set ${key} (checkbox) to:`, element.checked);
//             } else if (element.type === "radio") {
//                 let radioElement = document.getElementById(`${key}_${value}`);
//                 if (radioElement) {
//                     radioElement.checked = true;
//                     console.log(`Set ${key} (radio) to: ${value}`);
//                 } else {
//                     console.warn(`Radio button for ${key} with ID '${key}_${value}' not found.`);
//                 }
//             } else {
//                 element.value = value;
//                 console.log(`Set ${key} (input) to:`, element.value);
//             }

//             // Update UI labels for range inputs
//             if (element.type === "range") {
//                 let valueLabel = document.getElementById("current" + key);
//                 if (valueLabel) {
//                     valueLabel.textContent = `Value: ${value}`;
//                     console.log(`Updated label for ${key} to:`, valueLabel.textContent);
//                 }
//             }
//         }
//     }
// }

function showAlert(element, type, message) {
    element.className = `alert alert-${type}`;
    element.innerText = message;
    element.classList.remove("d-none");

    setTimeout(() => {
        element.classList.add("d-none");
    }, 5000);
}

document.addEventListener("DOMContentLoaded", function () {
    // Initialize visibility for switches
    document.querySelectorAll('.form-check-input[type="checkbox"]').forEach(switchElement => {
        let settingId = switchElement.id;
        toggleChildSettings(settingId, switchElement.checked);

        switchElement.addEventListener("change", function () {
            toggleChildSettings(settingId, this.checked);
        });
    });

    // Initialize visibility for radio buttons
    document.querySelectorAll('.form-check-input[type="radio"]').forEach(radioElement => {
        let settingId = radioElement.name;  // Radio buttons share a name
        updateRadioChildVisibility(settingId);

        radioElement.addEventListener("change", function () {
            updateRadioChildVisibility(settingId);
        });
    });
});


// Function to show/hide child settings based on checkbox switches
function toggleChildSettings(settingId, isChecked) {
    document.querySelectorAll(`#${settingId}_dependencies`).forEach(childElement => {
        if (isChecked) {
            childElement.classList.add("show");
        } else {
            childElement.classList.remove("show");
        }
    });
}

// Function to show/hide child settings based on radio selection
function updateRadioChildVisibility(settingId) {
    let selectedRadio = document.querySelector(`input[name="${settingId}"]:checked`);
    
    if (selectedRadio) {
        let showChild = selectedRadio.dataset.showChild === "true";
        let dependencies = document.getElementById(settingId + "_dependencies");

        if (dependencies) {
            dependencies.style.display = showChild ? "block" : "none";
        }
    }
}

// function updateSetting(settingId, newValue) {
//     fetch("/update_setting", {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({
//             camera_num: camera_num,
//             id: settingId,
//             value: newValue
//         })
//     })
//     .then(r => r.json())
//     .then(data => {
//         if (data.success) {
//             console.log(`Updated: Camera ${camera_num}, ${settingId} -> ${newValue}`);
//         }
//     });
// }

function updateSetting(settingId, newValue) {
    socket.emit("set_camera_state", {
        camera_num: cameraNum,
        path: `controls.${settingId}`,
        value: newValue
    });
}

// Function for slider settings
function adjustSliderSetting(settingId, value) {
    const slider = document.getElementById(settingId);
    const valueLabel = document.getElementById("current" + settingId);
    const unitLabel = document.getElementById(settingId + "_unit_label");
    const conversionSwitch = document.getElementById(settingId + "_conversion");

    // Check for conversion
    let displayValue = value;
    if (slider?.dataset.conversionEnabled === "true" && conversionSwitch?.checked) {
        const factor = parseFloat(slider.dataset.conversionFactor);
        if (!isNaN(factor)) {
            displayValue = (value / factor).toFixed(3);
        }
    }

    if (valueLabel) {
        valueLabel.textContent = `Value: ${displayValue}`;
        if (unitLabel) {
            unitLabel.style.display = 'inline';
        }
    }

    // Always send raw value to server
    console.log("adjustSliderSetting calls updateSetting");
    updateSetting(settingId, value);
}

document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('[id$="_conversion"]').forEach(switchElem => {
        const settingId = switchElem.id.replace('_conversion', '');
        const slider = document.getElementById(settingId);

        if (!slider) return;

        switchElem.addEventListener("change", () => {
            const isEnabled = switchElem.checked;
            const originalStep = slider.dataset.originalStep;
            const customStep = slider.dataset.conversionStep;
            const factor = parseFloat(slider.dataset.conversionFactor);

            if (isEnabled && !isNaN(factor)) {
                if (customStep) {
                    slider.step = customStep;
                } else {
                    slider.step = (parseFloat(originalStep) / factor).toFixed(6);
                }
            } else {
                slider.step = originalStep;
            }

            // Update label immediately after switching
            adjustSliderSetting(settingId, slider.value);
        });
    });
});

document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('input[type="range"]').forEach(slider => {
            const settingId = slider.id;
            const conversionEnabled = slider.dataset.conversionEnabled === "true";
            const conversionSwitch = document.getElementById(settingId + "_conversion");
    
            if (conversionEnabled && conversionSwitch?.checked) {
                console.log("input_type_range calls adjustSliderSetting");
                console.log("settingsId:", settingId, "slider.value:", slider.value);
                adjustSliderSetting(settingId, slider.value);
            }
        });
    });


// Function for switch settings
function toggleSwitchSetting(settingId) {
    let switchElement = document.getElementById(settingId);
    let newValue = switchElement.checked; // true/false
    console.log("toggleSwitchSetting calls updateSetting");
    updateSetting(settingId, newValue);
}

function updateRadioSetting(settingId, value) {
    console.log(`Radio changed: ${settingId} -> ${value}`);
    updateSetting(settingId, value);
    updateRadioChildVisibility(settingId);
}

function updateProfileList() {
    fetch('/get_profiles')
        .then(response => response.json())
        .then(data => {
            const loadTableBody   = document.querySelector("#configTable tbody");
            const deleteTableBody = document.querySelector("#deleteConfigTable tbody");

            if (!loadTableBody || !deleteTableBody) return;

            loadTableBody.innerHTML = "";
            deleteTableBody.innerHTML = "";

            if (!data || data.length === 0) {
                loadTableBody.innerHTML =
                    `<tr><td colspan="4">No profiles found</td></tr>`;
                deleteTableBody.innerHTML =
                    `<tr><td colspan="4">No profiles found to delete</td></tr>`;
                return;
            }

            // Active profile always first
            const sortedProfiles = [
                ...data.filter(p => p.active),
                ...data.filter(p => !p.active)
            ];

            sortedProfiles.forEach(profile => {
                const isActive = profile.active === true;

                const rowClass = isActive ? "table-success" : "";
                const checked  = isActive ? "checked" : "";
                const disabled = isActive ? "disabled" : "";

                const activeBadge = isActive
                    ? '<span class="badge bg-success">Active</span>'
                    : '<span class="text-muted">Inactive</span>';

                /* ---------------- Load table row ---------------- */
                loadTableBody.insertAdjacentHTML("beforeend", `
                    <tr class="${rowClass}">
                        <td>
                            <input type="radio"
                                   name="selectedConfig"
                                   value="${profile.filename}"
                                   data-model="${profile.model}"
                                   data-active="${isActive}"
                                   ${checked}>
                        </td>
                        <td>${profile.filename}</td>
                        <td>${profile.model}</td>
                        <td>${activeBadge}</td>
                    </tr>
                `);

                /* ---------------- Delete table row ---------------- */
                deleteTableBody.insertAdjacentHTML("beforeend", `
                    <tr class="${rowClass}">
                        <td>
                            <input type="radio"
                                   name="selectedDeleteConfig"
                                   value="${profile.filename}"
                                   data-model="${profile.model}"
                                   ${disabled}>
                        </td>
                        <td>${profile.filename}</td>
                        <td>${profile.model}</td>
                        <td>${activeBadge}</td>
                    </tr>
                `);
            });

            /* --- Load selection handling --- */
            document
                .querySelectorAll('input[name="selectedConfig"]')
                .forEach(radio => {
                    radio.addEventListener("change", () => {
                        const isActive = radio.dataset.active === "true";
                    });
                });
        })
        .catch(error => console.error("Error fetching profiles:", error));
}

document.addEventListener("DOMContentLoaded", function () {
    updateProfileList();

    // Handle "Load Anyway" button click
    document.getElementById("confirmLoadProfile").addEventListener("click", function () {
        const profileName = document.getElementById("mismatchProfileName").textContent;
        applyProfile(profileName);
        bootstrap.Modal.getInstance(document.getElementById("modelMismatchModal")).hide();
    });
});

</script>
